!function i(a,s,u){function d(e,t){if(!s[e]){if(!a[e]){var o="function"==typeof require&&require;if(!t&&o)return o(e,!0);if(c)return c(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var r=s[e]={exports:{}};a[e][0].call(r.exports,function(t){return d(a[e][1][t]||t)},r,r.exports,i,a,s,u)}return s[e].exports}for(var c="function"==typeof require&&require,t=0;t<u.length;t++)d(u[t]);return d}({1:[function(t,e,o){var n;Object.defineProperty(o,"__esModule",{value:!0}),o.DIR_MODEL="model",o.DIR_EVENT_CLICK="click",o.REG_SINGLE=/^\{\{(.*)\}\}$/,o.REG_MULTI=/\{\{(.*)\}\}/,o.REG_EVENT=/^(\w+)\((.*)\)$/,o.REG_STR=/^(['"])(.*?)\1$/,o.REG_MID_STR=/(['"])(.*?)\1/,o.REG_IN=/^\[(\w+)\]$/,o.REG_OUT=/^\((\w+)\)$/,o.REG_ATTR=/^[A-z_]\w*$/,o.REG_TEST_INPUT=/^((model))$/,o.REG_TEST_OUTPUT=/^((click))$/,(n=o.VNodeStatus||(o.VNodeStatus={}))[n.ACTIVE=0]="ACTIVE",n[n.INACTIVE=1]="INACTIVE",n[n.DEPRECATED=2]="DEPRECATED"},{}],2:[function(t,e,o){Object.defineProperty(o,"__esModule",{value:!0});var i=t("./model"),a=t("./onclick");o.DirectiveSet=function(t){var e=t.GetInput();for(var o in e)switch(o){case"model":i.ModelSet(e[o],t)}var n=t.GetOutput();for(var r in n)switch(r){case"click":a.OnClick(n[r],t)}},o.DirectiveWatch=function(t){var e=t.GetInput();for(var o in e)switch(o){case"model":i.ModelWatch(e[o],t)}}},{"./model":3,"./onclick":4}],3:[function(t,e,o){function n(t,e){if("select"!=t.NodeName.toLowerCase()){var o=t.Dom.getAttribute("type");switch(null!=o&&""!=o||(o="text"),o){case"text":t.Dom.value=e;break;case"radio":t.Dom.value==e?t.Dom.checked=!0:t.Dom.checked=!1;break;case"checkbox":"[object Array]"==toString.call(e)&&(-1==e.indexOf(t.Dom.value)?t.Dom.checked=!1:t.Dom.checked=!0)}}else t.Dom.value=e}Object.defineProperty(o,"__esModule",{value:!0}),o.ModelWatch=function(t,e){var o=e.Vdom.GetAttr("type");"input"==e.Vdom.NodeName.toLowerCase()&&"checkbox"==o?e.mvvm.$watchExp(e,t,function(t){n(e,t)},!0):e.mvvm.$watchExp(e,t,function(t){n(e,t)})},o.ModelSet=function(i,a){var t=a.mvvm.GetExpValue(i);n(a,t),a.Dom.addEventListener("input",function(t){if("select"!=a.NodeName.toLowerCase()){var e=a.Dom.getAttribute("type");switch(null!=e&&""!=e||(e="text"),e){case"text":case"radio":a.mvvm.SetValue(i,t.target.value);break;case"checkbox":var o=a.mvvm.GetExpValue(i);if("[object Array]"==toString.call(o)){var n=o,r=n.indexOf(t.target.value);-1==r?n.push(t.target.value):n.splice(r,1)}}}else a.mvvm.SetValue(i,t.target.value)})}},{}],4:[function(t,e,o){Object.defineProperty(o,"__esModule",{value:!0});var i=t("../const");o.OnClick=function(t,n){if(i.REG_EVENT.test(t)){var e=RegExp.$1,o=RegExp.$2;if(0<o.length){var r=o.split(",");n.Dom.addEventListener("click",function(){var t,o=[];r.forEach(function(t){if(i.REG_STR.test(t))o.push(RegExp.$2);else{if("true"===t)return void o.push(!0);"false"===t&&o.push(!1);var e=new Number(t).valueOf();isNaN(e)?o.push(n.mvvm.GetExpValue(t)):o.push(e.valueOf())}}),(t=n.mvvm).RevokeMethod.apply(t,[e].concat(o))})}else n.Dom.addEventListener("click",function(){n.mvvm.RevokeMethod(e)})}}},{"../const":1}],5:[function(t,e,o){Object.defineProperty(o,"__esModule",{value:!0});var r=t("./manager/components-manager"),i=t("./manager/value-manager");window.Rio={component:function(t,e){return e.$name=t,r.RegisterComponent(e,"default"),this},value:function(t){return i.RegisterValue(t,"default"),this},namespace:function(o){var n={component:function(t,e){return e.$name=t,r.RegisterComponent(e,o),n},value:function(t){return i.RegisterValue(t,o),n}};return n}},document.addEventListener("DOMContentLoaded",function(){r.Start()})},{"./manager/components-manager":6,"./manager/value-manager":7}],6:[function(t,e,o){Object.defineProperty(o,"__esModule",{value:!0});var i=t("../mvvm/mvvm"),a=t("../vnode/custom-node"),s=t("../vdom/vdom"),u=t("../util"),d=[],n={default:{}};function c(t,e){t=t.toLowerCase(),e=e.toLowerCase();var o=n[e]&&n[e][t];return o&&null==o.$id&&function(e){if(e.$id=e.$namespace+"_"+e.$name,null!=e.templateUrl&&(e.template=u.HttpGet(e.templateUrl),null==e.template))return u.LogError("path "+e.templateUrl+" not found");var t=(new DOMParser).parseFromString(e.template,"text/html").body.children[0];e.$domtree=s.TraverseDom(t),null!=e.styleUrl&&(e.style=u.HttpGet(e.styleUrl));if(null!=e.style){var o=e.style.replace(/(?!\s)([^\{\}]+)(?=\{[^\{\}]*\})/g,function(t){return"["+e.$id+"]"+t}),n=document.createElement("style");n.type="text/css",n.innerHTML=o,document.getElementsByTagName("head")[0].appendChild(n),function e(t,o){t.AddAttr(o);1==t.NodeType&&t.Children.forEach(function(t){e(t,o)})}(e.$domtree,e.$id)}}(o),o}function h(t,e){return t=t.toLowerCase(),e=e.toLowerCase(),!(!n[e]||!n[e][t])}o.Start=function(){!function t(e){var o=u.GetNS(e.nodeName);if(h(o.value,o.namespace||"default")){var n=c(o.value,o.namespace||"default");d.push({option:n,dom:e})}else for(var r=0;r<e.children.length;r++){var i=e.children[r];t(i)}}(document.body),d.forEach(function(t){var e=s.TraverseDom(t.dom),o=new i.MVVM(t.option),n=new a.CustomNode(e,null,null,o);n.ParseTemplate(),(o.FenceNode=n).AttachDom(),o.Reconstruct();var r=o.Render();o.StartWatch(),t.dom.parentElement.replaceChild(r,t.dom)})},o.RegisterComponent=function(t,e){t.$namespace=e.toLowerCase(),null==n[e]&&(n[e]={}),n[e][t.$name]=t},o.GetComponent=c,o.IsComponentRegistered=h},{"../mvvm/mvvm":9,"../util":15,"../vdom/vdom":16,"../vnode/custom-node":17}],7:[function(t,e,o){Object.defineProperty(o,"__esModule",{value:!0});var r={default:{}};o.RegisterValue=function(t,e){null==r[e]&&(r[e]={});var o=r[e];for(var n in t)o[n]=t[n]},o.GetValue=function(t,e){return r[e]&&r[e][t]},o.GetValues=function(t){return r[t]},o.IsValueRegistered=function(t,e){return!(!r[e]||!r[e][t])}},{}],8:[function(t,e,o){Object.defineProperty(o,"__esModule",{value:!0});var n=function(t,e){this.itemExp=t,this.arrayExp=e};o.ForExp=n},{}],9:[function(t,e,o){Object.defineProperty(o,"__esModule",{value:!0});var r=t("./revoke-event"),n=t("../observer/observe"),i=function(){function t(t){for(var e in this.methods={},this.Ins=[],this.Outs=[],this.hirented=!1,null!=t.data?this.data=JSON.parse(JSON.stringify(t.data)):this.data={},this.methods=t.methods||{},this.template=t.template,this.Namespace=t.$namespace,this.domtree=t.$domtree,t.methods&&t.methods.$init&&t.methods.$init.call(this),this.Ins=t.props||[],this.Outs=t.events||[],this.observe=new n.Observe(this.data),this.observe.Walk(),this.data)this.proxyData(e)}return t.prototype.proxyData=function(e){Object.defineProperty(this,e,{get:function(){return this.data[e]},set:function(t){this.data[e]=t}})},t.prototype.SetHirented=function(t){this.hirented=t},t.prototype.GetTemplate=function(){return this.template},t.prototype.GetDomTree=function(){return this.domtree},t.prototype.Render=function(){return this.TreeRoot.Render(),this.TreeRoot.Dom},t.prototype.RevokeMethod=function(t){for(var e,o=[],n=1;n<arguments.length;n++)o[n-1]=arguments[n];this.hirented?(e=this.FenceNode.mvvm).RevokeMethod.apply(e,[t].concat(o)):null!=this.methods[t]&&this.methods[t].apply(this,o)},t.prototype.GetExpValue=function(t){return this.observe.GetValueWithExp(t)},t.prototype.SetValue=function(t,e){for(var o=t.split("."),n=this.data,r=!0,i=0;i<o.length-1;i++){if(null==n){r=!1;break}n=n[o[i]]}r&&null!=n&&(n[o[o.length-1]]=e)},t.prototype.$emit=function(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];if(null!=this.FenceNode&&null!=this.FenceNode.mvvm){var n=this.FenceNode.GetOut(t);r.RevokeEvent(n,e,this.FenceNode.mvvm)}},t.prototype.$watchExp=function(t,e,o,n){this.observe.AddWatcher(t,e,o,n)},t.prototype.$ondestroy=function(){},t.prototype.Reconstruct=function(){var e=this;this.hirented&&Object.keys(this.FenceNode.mvvm.data).forEach(function(t){e.data[t]=e.FenceNode.mvvm.data[t],e.proxyData(t),e.observe.DefineReactive(e.data,t)}),this.Ins.forEach(function(t){e.data[t]=e.FenceNode.GetInValue(t),e.proxyData(t),e.observe.DefineReactive(e.data,t)}),this.TreeRoot.Reconstruct()},t.prototype.StartWatch=function(){var n=this;this.hirented&&Object.keys(this.FenceNode.mvvm.data).forEach(function(o){n.FenceNode.mvvm.$watchExp(n.FenceNode,o,function(t,e){n.data[o]=t})}),this.Ins.forEach(function(o){var t=n.FenceNode.GetIn(o);n.FenceNode.mvvm.$watchExp(n.FenceNode,t,function(t,e){n.data[o]=t})}),this.TreeRoot.StartWatch()},t}();o.MVVM=i},{"../observer/observe":12,"./revoke-event":10}],10:[function(t,e,o){Object.defineProperty(o,"__esModule",{value:!0});var s=t("../const");o.RevokeEvent=function(t,o,n){if(s.REG_EVENT.test(t)){var e=RegExp.$1,r=RegExp.$2;if(0<r.length){var i=r.split(","),a=[];i.forEach(function(t){if(s.REG_STR.test(t))a.push(RegExp.$2);else{if("true"===t)return void a.push(!0);if("false"===t)return void a.push(!1);if("$event"==t)return void a.push.apply(a,o);var e=new Number(t).valueOf();isNaN(e)?a.push(n.GetExpValue(t)):a.push(e.valueOf())}}),n.RevokeMethod.apply(n,[e].concat(a))}else n.RevokeMethod(e)}}},{"../const":1}],11:[function(t,e,o){Object.defineProperty(o,"__esModule",{value:!0});var n=[],r=!1;function i(){n.forEach(function(t){return t.Update()}),n=[]}o.AddWatcher=function(t){-1==n.indexOf(t)&&n.push(t),r||(r=!0,setTimeout(function(){i(),r=!1},0))},o.RevokeWatcher=i},{}],12:[function(t,e,o){Object.defineProperty(o,"__esModule",{value:!0}),t("./redefine-array");var r=t("./watcher"),n=t("./msg-queue"),i=t("../const"),a=function(){function a(t){this.data=t}return a.prototype.GetValue=function(t){a.target=t;var e=EvalSingle(this.data,t.Exp);return a.target=null,e},a.prototype.GetValueWithExp=function(t){return EvalSingle(this.data,t)},a.prototype.Walk=function(){this.walk(this.data)},a.prototype.AddWatcher=function(t,e,o,n){new r.Watcher(t,e,o,this,n)},a.prototype.RemoveWatcher=function(t,e){},a.prototype.walk=function(o){var n=this;null!=o&&"object"==typeof o&&Object.keys(o).forEach(function(t){var e=new s(t);n.defineReactive(o,t,!1,e),n.walk(o[t])})},a.prototype.DefineReactive=function(t,e){var o=new s(e);this.defineReactive(t,e,!0,o)},a.prototype.addArrayListener=function(t,e){null==t.$obs&&Object.defineProperty(t,"$obs",{enumerable:!1,configurable:!0,value:[]}),-1==t.$obs.indexOf(e)&&t.$obs.push(e)},a.prototype.defineReactive=function(t,e,o,n){var r=this,i=t[e];"[object Array]"==toString.call(i)&&this.addArrayListener(i,n),Object.defineProperty(t,e,{get:function(){return console.log("get key "+e,a.target),null!=a.target&&n.AddTarget(a.target),i},set:function(t){t!=i&&(i=t,"[object Array]"==toString.call(i)&&r.addArrayListener(i,n),o||r.walk(t),n.Notify())},enumerable:!0,configurable:!0})},a}();o.Observe=a;var s=function(){function t(t){this.key=t,this.watches=[]}return t.prototype.GetKey=function(){return this.key},t.prototype.AddTarget=function(t){-1==this.watches.indexOf(t)&&this.watches.push(t)},t.prototype.Notify=function(){this.watches=this.watches.filter(function(t){return t.GetVNode().GetStatus()==i.VNodeStatus.ACTIVE?(n.AddWatcher(t),!0):t.GetVNode().GetStatus()==i.VNodeStatus.INACTIVE||t.GetVNode().GetStatus()!=i.VNodeStatus.DEPRECATED&&void 0})},t}();o.Depender=s},{"../const":1,"./msg-queue":11,"./redefine-array":13,"./watcher":14}],13:[function(t,e,o){Object.defineProperty(o,"__esModule",{value:!0});var n=Array.prototype.push,r=Array.prototype.splice,i=Array.prototype.pop,a=Array.prototype.shift,s=Array.prototype.shift,u=function(t){null!=t&&t.forEach(function(t){return t.Notify()})};Array.prototype.push=function(){var t=n.apply(this,arguments);return u(this.$obs),t},Array.prototype.splice=function(){var t=this.length,e=r.apply(this,arguments);return this.length!=t&&u(this.$obs),e},Array.prototype.pop=function(){var t=i.apply(this,arguments);return u(this.$obs),t},Array.prototype.shift=function(){var t=a.apply(this,arguments);return u(this.$obs),t},Array.prototype.unshift=function(){var t=s.apply(this,arguments);return u(this.$obs),t}},{}],14:[function(t,e,o){Object.defineProperty(o,"__esModule",{value:!0});var n=t("../const"),r=function(){function t(t,e,o,n,r){if(this.vnode=t,this.Exp=e,this.cb=o,this.observer=n,this.deep=r,this.deepRecord=[],this.value=this.observer.GetValue(this),this.deep&&"[object Array]"==toString.call(this.value))for(var i=0;i<this.value.length;i++)this.deepRecord[i]=this.value[i]}return t.prototype.GetVNode=function(){return this.vnode},t.prototype.Update=function(){var t=this.observer.GetValue(this);if(this.value!=t)console.log(this.Exp+" callback"),this.vnode.GetStatus()==n.VNodeStatus.ACTIVE&&this.cb(t,this.value),this.value=t;else if(this.deep&&"[object Array]"==toString.call(this.value)){for(var e=!1,o=0;o<t.length;o++)if(t[o]!=this.deepRecord[o]){this.cb(t,this.value),e=!0;break}if(e){this.deepRecord=[];for(o=0;o<t.length;o++)this.deepRecord[o]=t[o]}}},t}();o.Watcher=r},{"../const":1}],15:[function(t,e,o){Object.defineProperty(o,"__esModule",{value:!0}),o.LogError=function(t){console.error(t)},o.LogInfo=function(t){console.log(t)},o.GetNS=function(t){var e=t.split(":");return 1==e.length?{namespace:null,value:e[0]}:2==e.length?{namespace:e[0],value:e[1]}:void 0},o.HttpGet=function(t){var e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(),4==e.readyState&&200==e.status?e.responseText:null}},{}],16:[function(s,t,e){Object.defineProperty(e,"__esModule",{value:!0});var u=s("../vnode/vnode"),d=s("../manager/components-manager"),c=s("../mvvm/mvvm"),h=s("../util"),a=function(){function t(){this.Attrs=[],this.Children=[]}return t.prototype.GetAttr=function(t){for(var e=0;e<this.Attrs.length;e++)if(this.Attrs[e].Name==t)return this.Attrs[e].Value;return null},t.prototype.AddAttr=function(t){this.Attrs.push({Name:t,Value:""})},t}();e.VDom=a,e.TraverseDom=function t(e){if(3!=e.nodeType||""!=e.nodeValue.trim()){var o=new a;if(o.NodeValue=e.nodeValue,o.NodeName=e.nodeName,o.NodeType=e.nodeType,1==e.nodeType){for(var n=e,r=0;r<n.attributes.length;r++)o.Attrs.push({Name:n.attributes[r].name,Value:n.attributes[r].value});for(r=0;r<n.childNodes.length;r++){var i=t(n.childNodes[r]);i&&o.Children.push(i)}}return o}},e.NewVNode=function(t,e,o){if("slot"==t.NodeName.toLowerCase())return new(s("../vnode/slot-node").SlotNode)(t,e,o,t.GetAttr("name"));if(null!=t.GetAttr("[for]"))return new(s("../vnode/for-node").ForNode)(t,e,o,t.GetAttr("[for]"));if(null!=t.GetAttr("[if]"))return new(s("../vnode/if-node").IfNode)(t,e,o,t.GetAttr("[if]"));var n=h.GetNS(t.NodeName);if(d.IsComponentRegistered(n.value,n.namespace||"default")){var r=d.GetComponent(n.value,n.namespace||"default"),i=new c.MVVM(r),a=new(s("../vnode/custom-node").CustomNode)(t,e,o,i);return(i.FenceNode=a).ParseTemplate(),a}return new u.VNode(t,e,o)},e.NewVNodeNoFor=function(t,e,o){if("slot"==t.NodeName.toLowerCase())return new(s("../vnode/slot-node").SlotNode)(t,e,o,t.GetAttr("name"));if(null!=t.GetAttr("[if]"))return new(s("../vnode/if-node").IfNode)(t,e,o,t.GetAttr("[if]"));var n=h.GetNS(t.NodeName);if(d.IsComponentRegistered(n.value,n.namespace||"default")){var r=d.GetComponent(n.value,n.namespace||"default"),i=new c.MVVM(r),a=new(s("../vnode/custom-node").CustomNode)(t,e,o,i);return(i.FenceNode=a).ParseTemplate(),a}return new u.VNode(t,e,o)},e.NewVNodeNoForNoIf=function(t,e,o){if("slot"==t.NodeName.toLowerCase())return new(s("../vnode/slot-node").SlotNode)(t,e,o,t.GetAttr("name"));var n=h.GetNS(t.NodeName);if(d.IsComponentRegistered(n.value,n.namespace||"default")){var r=d.GetComponent(n.value,n.namespace||"default"),i=new c.MVVM(r),a=new(s("../vnode/custom-node").CustomNode)(t,e,o,i);return(i.FenceNode=a).ParseTemplate(),a}return new u.VNode(t,e,o)}},{"../manager/components-manager":6,"../mvvm/mvvm":9,"../util":15,"../vnode/custom-node":17,"../vnode/for-node":18,"../vnode/if-node":19,"../vnode/slot-node":20,"../vnode/vnode":22}],17:[function(t,e,o){var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0});var s=t("../manager/components-manager"),u=t("../mvvm/mvvm"),d=t("../util"),c=t("../vdom/vdom"),h=t("./template-node"),p=t("./vnode"),i=function(i){function a(t,e,o,n){var r=i.call(this,t,e,o)||this;return r.Vdom=t,r.mvvm=e,r.Parent=o,r.SurroundMvvm=n,r}return r(a,i),a.prototype.AddIns=function(t,e){this.ins_exp[t]=e},a.prototype.GetTemplate=function(t){for(var e=0;e<this.Children.length;e++){var o=this.Children[e];if(o.templatename==t)return o}return null},a.prototype.Render=function(){this.Dom=this.SurroundMvvm.Render(),this.Dom&&this.Parent&&this.Parent.Dom&&this.Parent.Dom.appendChild(this.Dom)},a.prototype.childSet=function(){var t=new h.TemplateNode(this.Vdom,this.mvvm?this.mvvm:this.SurroundMvvm,this,"default");t.Parent=this;for(var e={default:t},o=0;o<this.Vdom.Children.length;o++){var n=this.Vdom.Children[o],r=this.Vdom.GetAttr("slot");null!=r&&""!=r||(r="default"),null==e[r]&&(e[r]=new h.TemplateNode(this.Vdom,this.mvvm?this.mvvm:this.SurroundMvvm,this,r),e[r].Parent=this);var i=c.NewVNode(n,e[r].mvvm,e[r]);i.AttachDom(),e[r].Children.push(i)}for(var a in e)this.Children.push(e[a])},a.prototype.ParseTemplate=function(){var t=this.SurroundMvvm.GetDomTree(),e=d.GetNS(t.NodeName);if(s.IsComponentRegistered(e.value,e.namespace||this.SurroundMvvm.Namespace)){var o=s.GetComponent(e.value,e.namespace||this.SurroundMvvm.Namespace),n=new u.MVVM(o),r=new a(t,this.SurroundMvvm,null,n);this.SurroundMvvm.TreeRoot=r,n.FenceNode=this,r.ParseTemplate()}else this.SurroundMvvm.TreeRoot=new p.VNode(t,this.SurroundMvvm,null);this.SurroundMvvm.TreeRoot.AttachDom()},a.prototype.GetInValue=function(t){return null!=this.ins_pure[t]?this.ins_pure[t]:null!=this.ins_exp[t]?this.mvvm.GetExpValue(this.ins_exp[t]):null},a.prototype.GetIn=function(t){return this.ins_pure[t]||this.ins_exp[t]},a.prototype.GetOut=function(t){return this.outs[t]},a.prototype.Reconstruct=function(){this.SurroundMvvm.Reconstruct()},a.prototype.Refresh=function(){this.SurroundMvvm.TreeRoot.Refresh()},a.prototype.StartWatch=function(){this.SurroundMvvm.StartWatch()},a.prototype.Update=function(){this.SurroundMvvm.TreeRoot.Update()},a.prototype.testOutput=function(t){return-1!=this.SurroundMvvm.Outs.indexOf(t)},a.prototype.testInput=function(t){return-1!=this.SurroundMvvm.Ins.indexOf(t)},a}(p.VNode);o.CustomNode=i},{"../manager/components-manager":6,"../mvvm/mvvm":9,"../util":15,"../vdom/vdom":16,"./template-node":21,"./vnode":22}],18:[function(t,e,o){var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0});var s=t("../models"),i=t("../mvvm/mvvm"),u=t("../vdom/vdom"),d=t("./custom-node"),a=t("./vnode"),c=t("../const"),h=function(a){function t(t,e,o,n){var r=a.call(this,t,e,o)||this;r.Vdom=t,r.mvvm=e,r.Parent=o,r.originForExp=n,r.dynamicVNodes=[],r.IsTemplate=!0;var i=r.originForExp.trim().split(/\s+/);return r.ForExp=new s.ForExp(i[0],i[2]),r}return r(t,a),t.prototype.newCopyNode=function(t){var e=this.ForExp.itemExp,o=new i.MVVM({props:[e]});o.SetHirented(!0);var n=new d.CustomNode(this.Vdom,this.mvvm,null,o);return(o.FenceNode=n).IsCopy=!0,n.AddIns(e,this.ForExp.arrayExp+"["+t+"]"),n},t.prototype.reImplementForExp=function(t){var e=this;if(t>this.dynamicVNodes.length){for(var o=[],n=this.dynamicVNodes.length,r=this.dynamicVNodes.length;r<t;r++){var i=this.newCopyNode(r),a=u.NewVNodeNoFor(this.Vdom,i.SurroundMvvm,null);a.AttachDom(),i.SurroundMvvm.TreeRoot=a,o.push(i)}return o.forEach(function(t){e.dynamicVNodes.push(t),t.Reconstruct(),t.Render(),t.StartWatch()}),this.Parent.AddChildren(this,o,n),void this.Parent.Refresh()}if(t<this.dynamicVNodes.length){var s=this.dynamicVNodes.splice(t);s.forEach(function(t){return t.SetStatus(c.VNodeStatus.DEPRECATED)}),this.Parent.RemoveChildren(s),this.Parent.Refresh()}},t.prototype.Reconstruct=function(){var e=this,t=this.mvvm.GetExpValue(this.ForExp.arrayExp);if(this.dynamicVNodes=[],"[object Array]"===toString.call(t)){for(var o=[],n=0;n<t.length;n++){var r=this.newCopyNode(n),i=u.NewVNodeNoFor(this.Vdom,r.SurroundMvvm,null);i.AttachDom(),r.SurroundMvvm.TreeRoot=i,o.push(r)}o.forEach(function(t){e.dynamicVNodes.push(t),t.Reconstruct()}),this.Parent.AddChildren(this,o,0)}},t.prototype.StartWatch=function(){this.mvvm.$watchExp(this,this.ForExp.arrayExp+".length",this.reImplementForExp.bind(this)),this.dynamicVNodes.forEach(function(t){return t.StartWatch()})},t.prototype.Update=function(){var t=this.mvvm.GetExpValue(this.ForExp.arrayExp);"[object Array]"===toString.call(t)&&this.reImplementForExp(t.length)},t.prototype.AttachDom=function(){},t.prototype.Render=function(){var e=this;this.dynamicVNodes.forEach(function(t){t.Render(),null!=t.Dom&&e.Parent.Dom.appendChild(t.Dom)})},t}(a.VNode);o.ForNode=h},{"../const":1,"../models":8,"../mvvm/mvvm":9,"../vdom/vdom":16,"./custom-node":17,"./vnode":22}],19:[function(t,e,o){var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0});var i=t("./vnode"),a=t("../vdom/vdom"),s=t("../const"),u=function(i){function t(t,e,o,n){var r=i.call(this,t,e,o)||this;return r.Vdom=t,r.mvvm=e,r.Parent=o,r.ifExp=n,r.IsTemplate=!0,r}return r(t,i),t.prototype.AttachDom=function(){},t.prototype.Render=function(){null!=this.dynamicVNode&&(this.dynamicVNode.Render(),null!=this.Parent?this.Parent.Dom.appendChild(this.dynamicVNode.Dom):this.Dom=this.dynamicVNode.Dom)},t.prototype.Update=function(){var t=this.mvvm.GetExpValue(this.ifExp);this.reImpletement(t)},t.prototype.StartWatch=function(){var e=this;this.mvvm.$watchExp(this,this.ifExp,function(t){return e.reImpletement(t)}),null!=this.dynamicVNode&&this.dynamicVNode.StartWatch()},t.prototype.reImpletement=function(t){t?(null==this.dynamicVNode?(this.instance(),this.dynamicVNode.Render(),this.dynamicVNode.StartWatch()):this.dynamicVNode.Update(),null!=this.Parent?(this.Parent.AddChildren(this,[this.dynamicVNode],0),this.Parent.Refresh()):(this.mvvm.FenceNode.Dom=this.dynamicVNode.Dom,this.mvvm.FenceNode.Parent.Refresh()),this.dynamicVNode.SetStatus(s.VNodeStatus.ACTIVE)):null!=this.dynamicVNode&&(null!=this.Parent?(this.Parent.RemoveChildren([this.dynamicVNode]),this.Parent.Refresh()):(this.mvvm.FenceNode.Dom=null,this.mvvm.FenceNode.Parent.Refresh()),this.dynamicVNode.SetStatus(s.VNodeStatus.INACTIVE))},t.prototype.Reconstruct=function(){this.mvvm.GetExpValue(this.ifExp)&&(this.instance(),null!=this.Parent&&this.Parent.AddChildren(this,[this.dynamicVNode],0))},t.prototype.instance=function(){this.dynamicVNode=a.NewVNodeNoForNoIf(this.Vdom,this.mvvm,null),this.dynamicVNode.IsCopy=!0,this.dynamicVNode.AttachDom(),this.dynamicVNode.Reconstruct()},t}(i.VNode);o.IfNode=u},{"../const":1,"../vdom/vdom":16,"./vnode":22}],20:[function(t,e,o){var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0});var i=function(i){function t(t,e,o,n){var r=i.call(this,t,e,o)||this;return r.vdom=t,r.mvvm=e,r.Parent=o,r.name=n,null!=r.name&&""!=r.name||(r.name="default"),r}return r(t,i),t.prototype.Render=function(){var t=this.mvvm.FenceNode.GetTemplate(this.name);if(null!=t)for(t.Render(),this.Dom=t.Dom;null!=this.Dom.firstChild;)this.Parent.Dom.appendChild(this.Dom.firstChild);return null},t.prototype.StartWatch=function(){var t=this.mvvm.FenceNode.GetTemplate(this.name);null!=t&&t.StartWatch()},t.prototype.Update=function(){var t=this.mvvm.FenceNode.GetTemplate(this.name);null!=t&&t.Update()},t}(t("./vnode").VNode);o.SlotNode=i},{"./vnode":22}],21:[function(t,e,o){var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0});var i=function(i){function t(t,e,o,n){var r=i.call(this,t,e,o)||this;return r.vdom=t,r.mvvm=e,r.Parent=o,r.templatename=n,r}return r(t,i),t.prototype.Render=function(){this.Dom=document.createElement("div"),this.Children.forEach(function(t){t.Render()})},t.prototype.StartWatch=function(){this.Children.forEach(function(t){t.StartWatch()})},t.prototype.Update=function(){var e=[];this.Children.forEach(function(t){e.push(t)}),e.forEach(function(t){t.Update()})},t}(t("./vnode").VNode);o.TemplateNode=i},{"./vnode":22}],22:[function(t,e,o){Object.defineProperty(o,"__esModule",{value:!0});var n=t("./../const"),r=t("../const"),i=t("../directive/dir-handler"),a=t("../vdom/vdom"),s=t("../util"),u=function(){function t(t,e,o){this.Vdom=t,this.mvvm=e,this.Parent=o,this.Attrs=[],this.Children=[],this.IsTemplate=!1,this.IsCopy=!1,this.ins_pure={},this.ins_exp={},this.outs={},this.status=n.VNodeStatus.ACTIVE}return t.prototype.AddProperty=function(t,e){if(e=e.trim(),n.REG_IN.test(t)){var o=RegExp.$1;if("for"==o||"if"==o)return;return this.testInput(o)?void(n.REG_STR.test(e)?this.ins_pure[o]=RegExp.$2:this.ins_exp[o]=e):void s.LogError("input "+o+" not exist on "+this.NodeName)}if(n.REG_OUT.test(t))return this.testOutput(RegExp.$1)?void(this.outs[RegExp.$1]=e):void s.LogError("output "+RegExp.$1+" not exist on "+this.NodeName);n.REG_ATTR.test(t)&&this.Attrs.push({name:t,value:e})},t.prototype.GetOutput=function(){return this.outs},t.prototype.GetInput=function(){return this.ins_exp},t.prototype.testOutput=function(t){return n.REG_TEST_OUTPUT.test(t)},t.prototype.testInput=function(t){return n.REG_TEST_INPUT.test(t)},t.prototype.Render=function(){if(1==this.NodeType){var e=document.createElement(this.NodeName);this.Attrs.forEach(function(t){e.setAttribute(t.name,t.value)}),this.Dom=e,this.Children.forEach(function(t){t.IsCopy||t.Render()}),i.DirectiveSet(this)}if(3==this.NodeType)if(this.Dom=document.createTextNode(this.NodeValue),r.REG_SINGLE.test(this.NodeValue))this.Dom.textContent=this.mvvm.GetExpValue(RegExp.$1);else if(n.REG_MULTI.test(this.NodeValue)){var t=this.multiBindParse(this.NodeValue);this.Dom.textContent=this.mvvm.GetExpValue(t)}else this.Dom.textContent=this.NodeValue;this.Parent&&this.Parent.Dom&&this.Parent.Dom.appendChild(this.Dom)},t.prototype.multiBindParse=function(t){for(var e="",o=t.match(/\{\{(.*?)\}\}/g),n=0,r=0,i=0;i<o.length;i++)r=t.indexOf(o[i]),e+='"'+t.substring(n,r)+'"+('+o[i].substring(2,o[i].length-2)+")",n=r+o[i].length;return e},t.prototype.StartWatch=function(){var o=this;if(1==this.NodeType)return this.Children.forEach(function(t){t.IsCopy||t.StartWatch()}),void i.DirectiveWatch(this);if(3==this.NodeType)if(console.log("xx"),r.REG_SINGLE.test(this.NodeValue))this.mvvm.$watchExp(this,RegExp.$1,function(t,e){o.Dom.textContent=t});else if(n.REG_MULTI.test(this.NodeValue)){var t=this.multiBindParse(this.NodeValue);this.mvvm.$watchExp(this,t,function(t,e){o.Dom.textContent=t})}},t.prototype.Update=function(){if(1==this.NodeType){var e=[];return this.Children.forEach(function(t){e.push(t)}),void e.forEach(function(t){t.Update()})}if(3==this.NodeType)if(r.REG_SINGLE.test(this.NodeValue))this.Dom.textContent=this.mvvm.GetExpValue(RegExp.$1);else if(n.REG_MULTI.test(this.NodeValue)){var t=this.multiBindParse(this.NodeValue);this.Dom.textContent=this.mvvm.GetExpValue(t)}else this.Dom.textContent=this.NodeValue},t.prototype.Refresh=function(){var e=this;if(!this.IsTemplate){var t=this.Dom.childNodes,o=[];this.Children.forEach(function(t){t.IsTemplate||null==t.Dom||(o=o.concat(t))});for(var n={old_j:-1,i:0,j:0},r=[];!(n.i>t.length-1);)if(n.j>o.length-1)r.push({type:"remove",node:t[n.i]}),n.i++,n.j=n.old_j+1;else if(t[n.i]==o[n.j].Dom)if(t[n.i]!=o[n.j].Dom);else{if(n.i<n.j)for(var i=n.old_j+1;i<n.j;)r.push({type:"add",beforeNode:t[n.i],node:o[i].Dom}),i++;n.old_j=n.j,n.i++,n.j++}else n.j++;n.j<o.length&&(r.push({type:"add",beforeNode:null,node:o[n.j].Dom}),n.j++),r.forEach(function(t){"add"==t.type&&(null!=t.beforeNode?e.Dom.insertBefore(t.node,t.beforeNode):e.Dom.appendChild(t.node)),"remove"==t.type&&t.node.remove()})}},t.prototype.AddChildren=function(t,e,o){for(var n=0;n<this.Children.length;n++)if(this.Children[n]==t){(r=this.Children).splice.apply(r,[n+1+o,0].concat(e));break}var r},t.prototype.RemoveChildren=function(e){e.forEach(function(t){return t.onremove()}),this.Children=this.Children.filter(function(t){return-1==e.indexOf(t)})},t.prototype.onremove=function(){},t.prototype.Reconstruct=function(){var e=[];this.Children.forEach(function(t){e.push(t)}),e.forEach(function(t){t.Reconstruct()})},t.prototype.basicSet=function(){this.NodeValue=this.Vdom.NodeValue,this.NodeName=this.Vdom.NodeName,this.NodeType=this.Vdom.NodeType;for(var t=0;t<this.Vdom.Attrs.length;t++)this.AddProperty(this.Vdom.Attrs[t].Name,this.Vdom.Attrs[t].Value)},t.prototype.childSet=function(){for(var t=0;t<this.Vdom.Children.length;t++){var e=this.Vdom.Children[t],o=a.NewVNode(e,this.mvvm,this);null!=o&&(o.AttachDom(),this.Children.push(o))}},t.prototype.AttachDom=function(){this.basicSet(),this.childSet()},t.prototype.SetStatus=function(e){this.status=e,this.Children.forEach(function(t){return t.SetStatus(e)})},t.prototype.GetStatus=function(){return this.status},t}();o.VNode=u},{"../const":1,"../directive/dir-handler":2,"../util":15,"../vdom/vdom":16,"./../const":1}]},{},[5]);var EvalSingle=function(context,exp){var res;with(context)res=eval(exp);return res};function EvalMulti(context,str){for(var res="",values=str.match(/\{\{(.*?)\}\}/g),start=0,end=0,i=0;i<values.length;i++){with(end=str.indexOf(values[i]),context)res+=str.substring(start,end)+eval(values[i].substring(2,values[i].length-2));start=end+values[i].length}return res}